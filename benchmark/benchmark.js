import {Bench} from 'tinybench'
import {Filter} from 'bad-words'
import leo from 'leo-profanity'

import BadWordsNext from '../lib/index.mjs'
import {dt} from '../lib/decode.mjs'

const en = (await import('module'))
  .createRequire(import.meta.url)('../data/en.json')

const badwords = new Filter()
const badwordsNext = new BadWordsNext({ data: en })

let counter = 0
const run = async (str) => {
  const bench = new Bench({ time: 100 })

  await bench
    .add('BadWordsNext:check', () => {
      badwordsNext.check(str)
    })
    .add('LeoProfanity:check', () => {
      leo.check(str)
    })
    .add('BadWords:check', () => {
      badwords.isProfane(str)
    })

    .add('BadWordsNext:filter', () => {
      badwordsNext.filter(str)
    })
    .add('LeoProfanity:filter', () => {
      leo.clean(str)
    })
    .add('BadWords:filter', () => {
      badwords.clean(str)
    })

  await bench.warmup()
  await bench.run()

  console.log('\x1b[34m%s\x1b[0m', `Run #${++counter}`)
  console.log()
  console.log('\x1b[32m%s\x1b[0m', 'Input string:')
  console.log()
  console.log(str)
  console.log()
  console.log('\x1b[32m%s\x1b[0m', 'Benchmark results:')
  console.log()
  console.table(bench.tasks.map(({ name, result = {} }) =>
    ({
      'Task Name': name,
      'Average Time (ns)': (result.mean || 0) * 1e6,
      'Variance (ns)': (result.variance || 0) * 1e6,
      'ops/sec': parseInt(result.hz.toString(), 10)
    })))
  console.log()
  console.log('\x1b[32m%s\x1b[0m', 'Check results:')
  console.log()
  console.log('BadWordsNext:check', badwordsNext.check(str))
  console.log('LeoProfanity:check', leo.check(str))
  console.log('BadWords:check', badwords.isProfane(str))
  console.log()
}

await run(dt('5465737420776f726420736578206865726520616e64206d616e7920776f72647320696e207468697320737472696e672061732077656c6c206173206d616e7920706f73736962696c697469657320746f20636865636b20616e642066696c7465722e2057652074657374207468697320737472696e6720616e642067657420736f6d6520726573756c74732e'))
await run(dt('53306d6520736821747420697320686572652e206a7573740920246869747474200a202020616e64200a6730200a4024686f6c20623030627320616e64206431636b73200a20656e64'))
await run(dt('4c6f72656d20697073756d20646f6c6f722073697420616d65742c20636f6e73656374657475722061646970697363696e6720656c69742e20566573746962756c756d2076656c20646f6c6f722061742066656c69732074656d706f7220657569736d6f642e20496e74656765722061632064696374756d206c6f72656d2c2071756973206d616c65737561646120656e696d2e205574206174206c6163696e6961206e6962682c207669746165206661756369627573206c65637475732e204d6f7262692065666669636974757220736f64616c65732065726f732065742068656e6472657269742e205072616573656e7420706f72747469746f72206672696e67696c6c61206e756e632c206e6563206d616c657375616461206e69736c2066617563696275732073697420616d65742e2043726173206c656f206573742c2066696e696275732071756973206c6967756c61207365642c206c6163696e6961206665756769617420746f72746f722e2053757370656e64697373652070756c76696e617220647569206d617373612c2069642070756c76696e61722073617069656e20706f7274612076697461652e0a0a4d6f726269206d6f6c6c69732073617069656e206174206a7573746f2068656e6472657269742c206e6f6e20756c6c616d636f7270657220647569207665686963756c612e205072616573656e742076656e656e617469732074656c6c7573206120616e7465206c616f7265657420656765737461732073697420616d6574206e6f6e206e6962682e2053757370656e646973736520636f6d6d6f646f206d616c657375616461206c656f2073697420616d65742070686172657472612e20416c697175616d2073656420696e74657264756d206573742c2069642068656e64726572697420616e74652e20566573746962756c756d2071756973206c656f206964206c656f207669766572726120756c747269636965732e205175697371756520657520616363756d73616e206e69736c2c20637572737573206d6f6c6c697320697073756d2e205365642074696e636964756e7420656c656966656e642073656d2c206575206469676e697373696d207175616d20616363756d73616e2076697461652e2055742063757273757320656e696d20657520706f727461206d6178696d75732e204e756c6c616d206567657420707572757320636f6e76616c6c69732c20636f6d6d6f646f206d6175726973206e65632c206461706962757320616e74652e20496e74657264756d206574206d616c6573756164612066616d657320616320616e746520697073756d207072696d697320696e2066617563696275732e0a0a5072616573656e7420617420696e74657264756d206f7263692e20566573746962756c756d206c6967756c612076656c69742c20696d70657264696574206e6f6e20636f6e76616c6c697320696e2c20706c6163657261742073697420616d6574206c6f72656d2e204e756c6c616d20706f737565726520656e696d206574206c65637475732076756c7075746174652c2076656c2072686f6e63757320697073756d20706f73756572652e20496e206e65632076697665727261207475727069732e2055742074656d707573206e69626820616320626962656e64756d20646170696275732e2041656e65616e206566666963697475722c206475692072757472756d20766573746962756c756d2073757363697069742c206d61676e612076656c697420696e74657264756d206f64696f2c2076697461652074656d706f72206c6563747573206e6973692065752065782e20496e20626962656e64756d20706f72747469746f7220706c6163657261742e20566573746962756c756d20766573746962756c756d2076756c707574617465206a7573746f206567657420636f6e6775652e2050656c6c656e746573717565207574206175677565206574206175677565206665726d656e74756d2068656e6472657269742076656c20657420616e74652e20446f6e6563206578206d692c206d6174746973207669746165207475727069732061742c20706f737565726520616c697175616d20657261742e2050726f696e2074696e636964756e7420656c69742065742076656c69742076656e656e6174697320616363756d73616e2e0a0a46757363652065752076656e656e61746973206c6f72656d2e2050686173656c6c7573206c6967756c61206c6f72656d2c207363656c6572697371756520696e20696e74657264756d206e65632c20616c697175616d207669746165206f7263692e204475697320696e20756c6c616d636f7270657220657261742c206e6f6e20706c616365726174206a7573746f2e204e756e63206672696e67696c6c61206d657475732066656c69732c206567657420766f6c75747061742075726e6120736f64616c65732076697461652e20496e2073656d70657220626962656e64756d206c6f626f727469732e2050656c6c656e746573717565206861626974616e74206d6f726269207472697374697175652073656e6563747573206574206e65747573206574206d616c6573756164612066616d65732061632074757270697320656765737461732e204d616563656e617320696e206c656f2073697420616d6574207475727069732076656e656e617469732076656e656e617469732071756973207365642073617069656e2e204675736365207175697320736f6c6c696369747564696e2070757275732e20457469616d206163206d6920756c7472696365732073617069656e2065666669636974757220636f6e64696d656e74756d20696e2064696374756d20616e74652e205072616573656e742065726f732073617069656e2c206f726e61726520656765742074656c6c75732061742c206d616c65737561646120766172697573206d617373612e204e756e632065676573746173206578206573742e20566573746962756c756d2065676574206c6f72656d206c696265726f2e20416c697175616d206e656320657374206575206e756e6320706f72747469746f7220696163756c69732e204d6f72626920657261742065782c20747269737469717565206120766573746962756c756d206e65632c20636f6e76616c6c6973206163206e756c6c612e20517569737175652076656c207175616d20696163756c69732c206672696e67696c6c612070757275732076656c2c20657569736d6f64206475692e2050686173656c6c7573206566666963697475722c206f64696f206e6f6e2066657567696174206665726d656e74756d2c20707572757320646f6c6f72207363656c657269737175652065726f732c2065742074696e636964756e74206d61676e6120616e74652061742073617069656e2e0a0a496e2076656e656e61746973206672696e67696c6c61206e756c6c612c2071756973206469676e697373696d20646f6c6f722074656d7075732074656d7075732e204e756e632076656c206a7573746f20636f6e76616c6c69732c206672696e67696c6c61206c696265726f2073697420616d65742c206d6f6c6573746965206d61676e612e20496e20617420636f6e64696d656e74756d20646f6c6f722c207175697320766976657272612061756775652e205072616573656e74207363656c657269737175652c206a7573746f2076656c2064696374756d207072657469756d2c2075726e61206d6173736120706f72747469746f72206e756c6c612c2076656c20636f6e64696d656e74756d206e697369206e69736c2076656c2061756775652e205175697371756520696e206e69626820696e206c656374757320636f6e64696d656e74756d20756c747269636965732069642065752076656c69742e2050686173656c6c75732074656d706f72207363656c65726973717565206c696265726f2072757472756d20706c6163657261742e204f72636920766172697573206e61746f7175652070656e617469627573206574206d61676e6973206469732070617274757269656e74206d6f6e7465732c206e61736365747572207269646963756c7573206d75732e20437572616269747572206c756374757320736f64616c6573206a7573746f2073697420616d65742076756c7075746174652e204375726162697475722076656e656e6174697320617263752072697375732c206e6f6e20636f6d6d6f646f206f7263692076697665727261206e6f6e2e205072616573656e7420636f6e6775652c206469616d20616320616c697175616d207665686963756c612c206c696265726f206c6967756c6120706f7375657265206f7263692c2076656c2066657567696174206c656f206e756c6c61206e65632070757275732e2043757261626974757220656666696369747572206e756e6320657261742c20696e20656c656d656e74756d20707572757320656c656d656e74756d20656765742e'))
